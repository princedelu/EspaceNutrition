/*! EspaceNutrition 06-10-2014 */
angular.module("underscore",[]).factory("_",function(){return window._}),$("#pleaseWaitDialog").hide(),angular.module("EspaceNutrition",["ngRoute","underscore"]).config(["$routeProvider","$locationProvider","$httpProvider",function($routeProvider,$locationProvider,$httpProvider){var access=routingConfig.accessLevels;$routeProvider.when("/",{templateUrl:"/partials/public.php",controller:"EspaceNutritionPublicCtrl",access:access.public}),$routeProvider.when("/paiementSuccess",{templateUrl:"/partials/public.php",controller:"EspaceNutritionPublicCtrl",action:"paiementSuccess",access:access.public}),$routeProvider.when("/login",{templateUrl:"/partials/login.html",controller:"EspaceNutritionCtrl",access:access.public}),$routeProvider.when("/dashboard",{templateUrl:"/partials/admin/dashboard.php",controller:"DashboardCtrl",action:"dashboard",access:access.user}),$routeProvider.when("/utilisateurs",{templateUrl:"/partials/admin/utilisateurs.php",controller:"UtilisateurCtrl",action:"listUtilisateur",access:access.admin}),$routeProvider.when("/paiements",{templateUrl:"/partials/admin/paiements.php",controller:"PaiementCtrl",action:"listPaiement",access:access.admin}),$routeProvider.when("/abonnements",{templateUrl:"/partials/admin/abonnements.php",controller:"AbonnementCtrl",action:"listAbonnement",access:access.admin}),$routeProvider.when("/mesabonnements",{templateUrl:"/partials/admin/abonnements.php",controller:"AbonnementCtrl",action:"listMesAbonnement",access:access.user}),$routeProvider.when("/mesures",{templateUrl:"/partials/admin/mesures.php",controller:"MesureCtrl",action:"listMesures",access:access.admin}),$routeProvider.when("/mesmesures",{templateUrl:"/partials/admin/mesures.php",controller:"MesureCtrl",action:"listMesMesures",access:access.user}),$routeProvider.when("/addpoids",{templateUrl:"/partials/admin/mesures.php",controller:"MesureCtrl",action:"addPoids",access:access.user}),$routeProvider.when("/addrepas",{templateUrl:"/partials/admin/mesures.php",controller:"MesureCtrl",action:"addRepas",access:access.user}),$routeProvider.when("/404",{templateUrl:"/partials/404.html",access:access.public}),$routeProvider.otherwise({redirectTo:"/404"}),$locationProvider.html5Mode(!0).hashPrefix("!"),$httpProvider.interceptors.push(function($q,$location,$window){return{request:function(config){if(config.headers=config.headers||{},$window.sessionStorage.token)config.headers.Authorization="Bearer "+$window.sessionStorage.token;else{var payLoad={};payLoad.iss="http://www.espace-nutrition.fr",payLoad.aud="Espace Nutrition",payLoad.exp=Math.round((new Date).getTime()/1e3)+60,payLoad.role="anonyme";var jPayLoad=JSON.stringify(payLoad);config.headers.Authorization="BearerPublic "+utf8tob64u(jPayLoad)}return config},responseError:function(response){return 401===response.status?($location.path("/login"),$q.reject(response)):$q.reject(response)}}})}]).run(["$rootScope","$location","$window","Auth",function($rootScope,$location,$window,Auth){$rootScope.$on("$routeChangeStart",function(event,next,current){$rootScope.error=null,void 0!==current&&void 0!==current.$$route&&($rootScope[current.$$route.originalPath.split("/")[1]]=!1),void 0!==next&&void 0!==next.$$route&&($rootScope[next.$$route.originalPath.split("/")[1]]=!0),Auth.adaptCurrentUser(),Auth.authorize(next.access)||$location.path(Auth.isLoggedIn()?"/dashboard":"/login")})}]),function(){"use strict";angular.module("EspaceNutrition").controller("AbonnementCtrl",["$rootScope","$scope","$location","$route","$window","Auth","AbonnementFactory","UtilisateurFactory",function($rootScope,$scope,$location,$route,$window,Auth,AbonnementFactory,UtilisateurFactory){$scope.user=Auth.user,$scope.userRoles=Auth.userRoles,$scope.accessLevels=Auth.accessLevels;var action="";switch(void 0!==$route&&$route.current&&void 0!==$route.current.action&&(action=$route.current.action),$scope.listAbonnement=function(){$scope.success="",$scope.error="",$scope.loading=!0,AbonnementFactory.list(function(res){$scope.loading=!1;{var data=$.map(res,function(el){return[[el.ID,el.EMAIL,el.DATEDEBUT,el.DATEFIN,el.TYPE,el.ACTIF,""]]});$("#abonnements").dataTable({aaData:data,aoColumns:[{sTitle:"Id"},{sTitle:"Email"},{sTitle:"Date de début"},{sTitle:"Date de fin"},{sTitle:"Type"},{sTitle:"Actif"},{sTitle:"Action"}],oLanguage:{sSearch:"Recherche:",sZeroRecords:"Pas d'éléménts à afficher",sInfo:"_START_ sur _END_ de _TOTAL_ éléments",sInfoEmpty:"Pas d'éléments",sInfoFiltered:" - filtrés sur _MAX_ éléments",sLengthMenu:"Afficher _MENU_ éléments",oPaginate:{sFirst:"Premier",sLast:"Dernier",sNext:"Suivant",sPrevious:"Précédent"}},aoColumnDefs:[{targets:0,visible:!1,searchable:!1},{targets:5,sType:"html",render:function(data){var spanOuv="&lt;span class=&quot;label ",label="";switch(data){case!1:label="label-info&quot;&gt;Non actif";break;case!0:label="label-success&quot;&gt;Actif";break;default:label="label-danger&quot;&gt;???"}var spanFerm="&lt;/span&gt;",result=spanOuv.concat(label).concat(spanFerm);return $("<div/>").html(result).text()}},{targets:6,sType:"html",render:function(data,type,row){var result="",resultTmp="",id="",fin="";return resultTmp="&lt;button class=&quot;btn btn-link app-btn-delete&quot; ng-click=&quot;delete(",id=row[0],fin=")&quot; type=&quot;button&quot;&gt;&lt;span class=&quot;fa fa-times&quot;&gt;&lt;/span&gt;&lt;/button&gt;",result=result.concat(resultTmp).concat(id).concat(fin),$("<div/>").html(result).text()}}],order:[[1,"desc"]]})}$("#abonnements tbody").on("click","button",function(){var name=this.attributes[1].nodeName,value=this.attributes[1].nodeValue,tab="",result="";"ng-click"==name&&-1!=value.indexOf("delete")&&(tab=value.split("("),result=tab[1],tab=result.split(")"),result=tab[0],$scope.supprimer(result))})},function(){$scope.error="Impossible de recuperer les abonnements",$scope.loading=!1})},$scope.supprimer=function(id){$scope.success="",$scope.error="";var retVal=confirm("Voulez vous supprimer cet abonnement?");retVal===!0&&AbonnementFactory.supprimer(id,function(){$scope.success="Succes",$route.reload()},function(err){$scope.error=err,$route.reload()})},$scope.listMesAbonnement=function(){$scope.success="",$scope.error="",$scope.loading=!0,AbonnementFactory.listMine(function(res){$scope.loading=!1;{var data=$.map(res,function(el){return[[el.ID,el.EMAIL,el.DATEDEBUT,el.DATEFIN,el.TYPE,el.ACTIF]]});$("#abonnements").dataTable({aaData:data,aoColumns:[{sTitle:"Id"},{sTitle:"Email"},{sTitle:"Date de début"},{sTitle:"Date de fin"},{sTitle:"Type"},{sTitle:"Actif"}],oLanguage:{sSearch:"Recherche:",sZeroRecords:"Pas d'éléménts à afficher",sInfo:"_START_ sur _END_ de _TOTAL_ éléments",sInfoEmpty:"Pas d'éléments",sInfoFiltered:" - filtrés sur _MAX_ éléments",sLengthMenu:"Afficher _MENU_ éléments",oPaginate:{sFirst:"Premier",sLast:"Dernier",sNext:"Suivant",sPrevious:"Précédent"}},aoColumnDefs:[{targets:0,visible:!1,searchable:!1},{targets:5,sType:"html",render:function(data){var spanOuv="&lt;span class=&quot;label ",label="";switch(data){case!1:label="label-info&quot;&gt;Non actif";break;case!0:label="label-success&quot;&gt;Actif";break;default:label="label-danger&quot;&gt;???"}var spanFerm="&lt;/span&gt;",result=spanOuv.concat(label).concat(spanFerm);return $("<div/>").html(result).text()}}],order:[[1,"desc"]]})}},function(){$scope.error="Impossible de recuperer les abonnements",$scope.loading=!1})},$scope.createLoad=function(){$scope.success="",$scope.error="",$scope.email="",$scope.datedebut="",$scope.datefin="",$scope.id="",UtilisateurFactory.list(function(res){$scope.success="Succes";var result=_.filter(res,function(user){return user.role<2});$scope.users=result},function(err){$scope.error=err}),$("#datedebut").datepicker({format:"dd-mm-yyyy",autoclose:!0,weekStart:1}).on("changeDate",function(e){$scope.datedebut=e.currentTarget.value}),$("#datefin").datepicker({format:"dd-mm-yyyy",autoclose:!0,weekStart:1}).on("changeDate",function(e){$scope.datefin=e.currentTarget.value}),$("#bs-abonnement").modal("show")},$scope.add=function(){$scope.success="",$scope.error="",$scope.doublon="false",$scope.errorDate="false",$scope.pbuser="false";var dateDebutTab=$scope.datedebut.split("-"),dateDebutOrder=dateDebutTab[2]+dateDebutTab[1]+dateDebutTab[0],dateFinTab=$scope.datefin.split("-"),dateFinOrder=dateFinTab[2]+dateFinTab[1]+dateFinTab[0];if(dateDebutOrder>dateFinOrder)$scope.errorDate="true";else{var objetValue={};objetValue.email=$scope.email.email,objetValue.datedebut=$scope.datedebut,objetValue.datefin=$scope.datefin,objetValue.type=$scope.type,""===$scope.id?AbonnementFactory.put(objetValue,function(){$scope.success="Succes",$("#bs-abonnement").on("hidden.bs.modal",function(){$route.reload()}),$("#bs-abonnement").modal("hide")},function(err){$scope.error=err,"Doublon"==err&&($scope.doublon="true"),"PbUser"==err&&($scope.pbuser="true")}):(objetValue.id=$scope.id,AbonnementFactory.post(objetValue,function(){$scope.success="Succes",$("#bs-abonnement").on("hidden.bs.modal",function(){$route.reload()}),$("#bs-abonnement").modal("hide")},function(err){$scope.error=err,"Doublon"==err&&($scope.doublon="true"),"PbUser"==err&&($scope.pbuser="true")}))}},action){case"listAbonnement":$scope.listAbonnement();break;case"listMesAbonnement":$scope.listMesAbonnement()}}])}(),function(){"use strict";angular.module("EspaceNutrition").factory("AbonnementFactory",["$http",function($http){return{list:function(success,error){$http.get("/api/abonnements").success(success).error(error)},listMine:function(success,error){$http.get("/api/mesabonnements").success(success).error(error)},supprimer:function(id,success,error){$http({method:"DELETE",url:"/api/abonnement/"+id}).success(success).error(error)},put:function(objet,success,error){$http.put("/api/abonnement",objet).success(success).error(error)},post:function(objet,success,error){$http.post("/api/abonnement",objet).success(success).error(error)}}}])}(),function(){"use strict";angular.module("EspaceNutrition").controller("EspaceNutritionCtrl",["$rootScope","$scope","$location","$route","$window","Auth","UtilisateurFactory",function($rootScope,$scope,$location,$route,$window,Auth){$scope.user=Auth.user,$scope.userRoles=Auth.userRoles,$scope.accessLevels=Auth.accessLevels,$scope.role="1",void 0!==$location.search().token?$scope.token=$location.search().token:$scope.confirmpassword="value",$scope.logout=function(){delete $window.sessionStorage.token,$location.path("/login")},$scope.login=function(){void 0===$scope.token?Auth.login({email:$scope.email,password:$scope.password},function(res){$window.sessionStorage.token=res,$location.path("/dashboard")},function(err){$scope.error=err}):$scope.password!=$scope.confirmpassword?$scope.error="Les mots de passe ne sont pas identiques":Auth.modificationPassword({email:$scope.email,password:$scope.password,token:$scope.token},function(res){$window.sessionStorage.token=res,$location.path("/dashboard")},function(err){$scope.error=err})},$scope.go=function(path){$window.location.href=path},$scope.demandeChangementPassword=function(){$scope.success="",$scope.error="",void 0===$scope.email?$scope.error="Veuillez saisir votre email":Auth.sendMailToken({email:$scope.email},function(){$scope.success="Un mail a été envoyé à l adresse ci-dessous afin de modifier votre mot de passe"},function(err){$scope.error=err})},$scope.monprofilLoad=function(){$scope.success="",$scope.error="",Auth.get(function(res){$scope.email=res.EMAIL,$scope.nom=res.NOM,$scope.prenom=res.PRENOM,$scope.datenaissance=res.DATENAISSANCE,$scope.id=res.ID,$scope.success="Succes",$("#dateNaissanceProfil").datepicker({format:"dd-mm-yyyy",autoclose:!0,weekStart:1}).on("changeDate",function(e){$scope.datenaissance=e.currentTarget.value}),$("#bs-profil").modal("show")},function(err){$scope.error=err})},$scope.updateProfil=function(){if($scope.success="",$scope.error="",$scope.password!=$scope.passwordConfirm)$scope.error="Les mots de passe ne sont pas identiques";else{var objetValue={};objetValue.email=$scope.email,objetValue.nom=$scope.nom,objetValue.password=$scope.password,objetValue.prenom=$scope.prenom,objetValue.datenaissance=$scope.datenaissance,objetValue.id=$scope.id,objetValue.profil=1,Auth.post(objetValue,function(){$scope.success="Succes",$("#bs-profil").modal("hide")},function(err){$scope.error=err})}},$scope.offcanvas=function(){$(window).width()<=992?($(".row-offcanvas").toggleClass("active"),$(".left-side").removeClass("collapse-left"),$(".right-side").removeClass("strech"),$(".row-offcanvas").toggleClass("relative")):($(".left-side").toggleClass("collapse-left"),$(".right-side").toggleClass("strech"))}}])}(),function(){"use strict";angular.module("EspaceNutrition").directive("accessLevel",["Auth",function(Auth){return{restrict:"A",link:function($scope,element,attrs){function updateCSS(){userRole&&accessLevel&&(Auth.authorize(accessLevel,userRole)?element.css("display",prevDisp):element.css("display","none"))}var userRole,accessLevel,prevDisp=element.css("display");$scope.user=Auth.user,$scope.$watch("user",function(user){user.role&&(userRole=user.role),updateCSS()},!0),attrs.$observe("accessLevel",function(al){al&&(accessLevel=$scope.$eval(al)),updateCSS()})}}}]),angular.module("EspaceNutrition").directive("activeNav",["$location",function($location){return{restrict:"A",link:function(scope,element){var nestedA=element.find("a")[0],path=nestedA.href;scope.location=$location,scope.$watch("location.absUrl()",function(newPath){path===newPath?element.addClass("active"):element.removeClass("active")})}}}]);var FLOAT_REGEXP=/^\-?\d+((\.|\,)\d+)?$/;angular.module("EspaceNutrition").directive("smartFloat",function(){return{require:"ngModel",link:function(scope,elm,attrs,ctrl){ctrl.$parsers.unshift(function(viewValue){return FLOAT_REGEXP.test(viewValue)?(ctrl.$setValidity("float",!0),parseFloat(viewValue.replace(",","."))):void ctrl.$setValidity("float",!1)})}}}),angular.module("EspaceNutrition").directive("d3CourbePoids",["$rootScope","$location","$window",function($rootScope,$location,$window){return{restrict:"E",replace:!1,scope:{data:"=data"},link:function(scope,element){function returnDigit(val){var re=/\d+/,digit=val.match(re)[0];return digit}function getParentWidth(){var widthParent;return widthParent=100==returnDigit(parent.css("width"))?838:returnDigit(parent.css("width")),widthParent-returnDigit(parent.css("padding-left"))-returnDigit(parent.css("padding-right"))}var parent=(angular.element($window),angular.element(element.parent())),w=getParentWidth(),h=450,nbTickDateMax=Math.round(w/120),monthNames=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],maxDataPointsForDots=50,margin=40;scope.render=function(data){var svg=null,yAxisGroup=null,xAxisGroup=null,dataCirclesGroup=null,dataLinesGroup=null;if(void 0!==data){d3.select("svg").remove(),svg=d3.select(element[0]).select("svg").select("g"),svg.empty()&&(svg=d3.select(element[0]).append("svg:svg").attr("width",w).attr("height",h).attr("class","viz").append("svg:g").attr("transform","translate("+margin+","+margin+")"));var min=d3.min(data,function(d){return parseFloat(d.value)});min-=10;var pointRadius=4,x=d3.time.scale().range([0,w-2*margin]).domain([data[0].date,data[data.length-1].date]),max=d3.max(data,function(d){return parseFloat(d.value)});max+=10;var y=d3.scale.linear().range([h-2*margin,0]).domain([min,max]),xAxis=d3.svg.axis().scale(x).tickSize(h-2*margin).tickPadding(20).ticks(nbTickDateMax).tickFormat(d3.time.format("%d/%m/%Y")),yAxis=d3.svg.axis().scale(y).orient("left").tickSize(-w+2*margin).tickPadding(10).ticks(10);yAxisGroup=svg.append("svg:g").attr("class","yTick").call(yAxis),svg.append("text").attr("transform","rotate(-90)").attr("y",0-margin).attr("x",40-h/2).attr("dy","1em").style("text-anchor","middle").attr("class","textPoids").text("Poids"),xAxisGroup=svg.append("svg:g").attr("class","xTick").call(xAxis),dataLinesGroup=svg.append("svg:g");var dataLines=dataLinesGroup.selectAll(".data-line").data([data]),line=d3.svg.line().x(function(d){return x(d.date)}).y(function(d){return y(d.value)}).interpolate("linear");dataLines.enter().append("path").attr("class","data-line").style("opacity",.3).attr("d",line(data)),dataCirclesGroup=svg.append("svg:g");var circles=dataCirclesGroup.selectAll(".data-point").data(data);circles.enter().append("svg:circle").attr("class","data-point").style("opacity",1).attr("cx",function(d){return x(d.date)}).attr("cy",function(d){return y(d.value)}).attr("r",function(){return data.length<=maxDataPointsForDots?pointRadius:0}),$("svg circle").tipsy({gravity:"w",html:!0,title:function(){var d=this.__data__,pDate=d.date;return"Date : "+pDate.getDate()+" "+monthNames[pDate.getMonth()]+" "+pDate.getFullYear()+"<br>Valeur : "+d.value}})}},scope.$watch("data",function(){scope.render(scope.data)},!0)}}}])}(),function(){"use strict";$(function(){$(".page-scroll a").bind("click",function(event){var $anchor=$(this);$("html, body").stop().animate({scrollTop:$($anchor.attr("href")).offset().top},1500,"easeInOutExpo"),event.preventDefault()})}),$(function(){$("body").on("input propertychange",".floating-label-form-group",function(e){$(this).toggleClass("floating-label-form-group-with-value",!!$(e.target).val())}).on("focus",".floating-label-form-group",function(){$(this).addClass("floating-label-form-group-with-focus")}).on("blur",".floating-label-form-group",function(){$(this).removeClass("floating-label-form-group-with-focus")})}),$("body").scrollspy({target:".navbar-fixed-top"}),$(".navbar-collapse ul li a").click(function(){$(".navbar-toggle:visible").click()})}(),function(exports){function buildRoles(roles){var bitMask="01",userRoles={};for(var role in roles){var intCode=parseInt(bitMask,2);userRoles[roles[role]]={bitMask:intCode,title:roles[role]},bitMask=(intCode<<1).toString(2)}return userRoles}function buildAccessLevels(accessLevelDeclarations,userRoles){var accessLevels={};for(var level in accessLevelDeclarations){var role,resultBitMask="";if("string"==typeof accessLevelDeclarations[level])if("*"==accessLevelDeclarations[level]){for(role in userRoles)resultBitMask+="1";accessLevels[level]={bitMask:parseInt(resultBitMask,2),title:accessLevelDeclarations[level]}}else console.log("Access Control Error: Could not parse '"+accessLevelDeclarations[level]+"' as access definition for level '"+level+"'");else{resultBitMask=0;for(role in accessLevelDeclarations[level])userRoles.hasOwnProperty(accessLevelDeclarations[level][role])?resultBitMask|=userRoles[accessLevelDeclarations[level][role]].bitMask:console.log("Access Control Error: Could not find role '"+accessLevelDeclarations[level][role]+"' in registered roles while building access for '"+level+"'");accessLevels[level]={bitMask:resultBitMask,title:accessLevelDeclarations[level][role]}}}return accessLevels}var config={roles:["public","user","admin"],accessLevels:{"public":"*",anon:["public"],userOnly:["user"],user:["user","admin"],admin:["admin"]}};exports.userRoles=buildRoles(config.roles),exports.accessLevels=buildAccessLevels(config.accessLevels,exports.userRoles),exports.publicKey="-----BEGIN PUBLIC KEY-----\nMIIBITANBgkqhkiG9w0BAQEFAAOCAQ4AMIIBCQKCAQBZQM9sX8M0PBHlNYO5iyHW\n/0La4UUIfLh1DlMy1lnyqlfLlRZCsyUkhzRaEAL5xrgo5qJFQvM3+CRYj4haaI4i\nGOvGe7CkdBgqGKR8EOtxHKO5lze5h474dcQodKUdK3YRpwu85fqQ8DRunTYt8O59\n+eIJhchW0tVP0LdT/x2nT9aFzxQh8g6yHT7ym4t5GrIjsapRsGZU7X0pH585HV2D\n/qpgfgnyL3sEHvN9vMRKIz+cj2JsAPu6w5s/j1hDVXvxF+C5tFYrvom9LF8C6cpQ\nPHzhI0hKAYEsV5psGqn1j1t7HA2+iSMsdPUEQqgM+IUoLaTGDFpQtgHmYi392UiB\nAgMBAAE=\n-----END PUBLIC KEY-----",exports.paypal={},exports.paypal.business="admin@espace-nutrition.fr",exports.paypal.urlReturn="http://espace-nutrition.fr/paiementSuccess",exports.paypal.urlCancel="http://espace-nutrition.fr",exports.paypal.urlNotify="http://espace-nutrition.fr/api/notifyPaiement",exports.paypal.sandbox=!0,exports.item={},exports.item[1]={},exports.item[1].libelle="EspaceNutrition - Consultation en ligne",exports.item[1].amount="50",exports.item[2]={},exports.item[2].libelle="EspaceNutrition - Suivi en ligne",exports.item[2].amount="80",exports.item[3]={},exports.item[3].libelle="EspaceNutrition - Consultation et suivi en ligne",exports.item[3].amount="100"}("undefined"==typeof exports?this.routingConfig={}:exports),function(){"use strict";angular.module("EspaceNutrition").factory("Auth",["$http","$window",function($http,$window){function changeUser(user){_.extend(currentUser,user)}function verifyToken(token){var isValid=!1;try{isValid=KJUR.jws.JWS.verify(token,publicKey);var pClaim=readToken(token);pClaim.exp<Math.round((new Date).getTime()/1e3)&&(isValid=!1)}catch(ex){isValid=!1}return isValid}function readToken(token){var a=token.split("."),uClaim=b64utos(a[1]);return KJUR.jws.JWS.readSafeJSONString(uClaim)}function adaptUser(token){var result={email:"",role:userRoles.public};if(void 0!==token)if(verifyToken(token)){var roleUser,pClaim=readToken(token);roleUser=1==pClaim.role?userRoles.user:2==pClaim.role?userRoles.admin:userRoles.public,result={email:pClaim.email,role:roleUser}}else delete $window.sessionStorage.token;return result}{var accessLevels=routingConfig.accessLevels,userRoles=routingConfig.userRoles,publicKey=routingConfig.publicKey,currentUser=adaptUser($window.sessionStorage.token);userRoles.public}return{authorize:function(accessLevel,role){return void 0===accessLevel&&(accessLevel=userRoles.admin),void 0===role&&(role=currentUser.role),accessLevel.bitMask&role.bitMask},isLoggedIn:function(user){return void 0===user&&(user=currentUser),verifyToken($window.sessionStorage.token)&&(user.role.title==userRoles.user.title||user.role.title==userRoles.admin.title)},adaptCurrentUser:function(){changeUser(adaptUser($window.sessionStorage.token))},login:function(user,success,error){$http.post("/api/login",user).success(function(token){var adaptedUser=adaptUser(token.value);changeUser(adaptedUser),success(token.value)}).error(error)},modificationPassword:function(user,success,error){$http.post("/api/modificationPassword",user).success(function(token){adaptUser(token.value);success(token.value)}).error(error)},sendMailToken:function(user,success,error){$http.post("/api/sendMailToken",user).success(success).error(error)},post:function(objet,success,error){currentUser.role==userRoles.admin?$http.post("/api/utilisateur",objet).success(success).error(error):$http.post("/api/monprofil",objet).success(success).error(error)},get:function(success,error){$http.get("/api/profil").success(success).error(error)},accessLevels:accessLevels,userRoles:userRoles,user:currentUser}}])}(),function(){"use strict";angular.module("EspaceNutrition").controller("DashboardCtrl",["$rootScope","$scope","$location","$route","$window","Auth","PoidsFactory","MesureFactory",function($rootScope,$scope,$location,$route,$window,Auth,PoidsFactory,MesureFactory){$scope.user=Auth.user,$scope.userRoles=Auth.userRoles,$scope.accessLevels=Auth.accessLevels;var action="";switch(void 0!==$route&&$route.current&&void 0!==$route.current.action&&(action=$route.current.action),$scope.getDataDashBoard=function(){var data=[];MesureFactory.getLastMesure(function(res){_.each(res,function(mesure){"POIDS"==mesure.TYPE?($scope.lastPoids=mesure.POIDS,$scope.lastPoidsDate="le "+mesure.DATEMESURE):"REPAS"==mesure.TYPE&&($scope.lastRepasDate="le "+mesure.DATEMESURE+" à "+mesure.HEUREMESURE)})},function(err){$scope.error=err}),PoidsFactory.list($scope.user.email,function(res){_.each(res,function(poids){var dateMesureTab=poids.DATEMESURE.split("-"),dateMesureEn=dateMesureTab[2]+"-"+dateMesureTab[1]+"-"+dateMesureTab[0];data.push({value:poids.POIDS,date:new Date(dateMesureEn)})}),$scope.dataPoids=data},function(err){$scope.error=err})},action){case"dashboard":$scope.getDataDashBoard()}}])}(),function(){"use strict";angular.module("EspaceNutrition").controller("MesureCtrl",["$rootScope","$scope","$location","$route","$window","PoidsFactory","RepasFactory","MesureFactory","UtilisateurFactory","Auth",function($rootScope,$scope,$location,$route,$window,PoidsFactory,RepasFactory,MesureFactory,UtilisateurFactory,Auth){$scope.user=Auth.user,$scope.userRoles=Auth.userRoles,$scope.accessLevels=Auth.accessLevels;var action="";switch(void 0!==$route&&$route.current&&void 0!==$route.current.action&&(action=$route.current.action),$scope.changeUserMesure=function(){$scope.showButtonViewPoidsCourbe="Tous"==$scope.usermesure.email?!1:!0,$("#mesures").fullCalendar("refetchEvents")},$scope.viewCourbePoids=function(){var data=[];PoidsFactory.list($scope.usermesure.email,function(res){_.each(res,function(poids){var dateMesureTab=poids.DATEMESURE.split("-"),dateMesureEn=dateMesureTab[2]+"-"+dateMesureTab[1]+"-"+dateMesureTab[0];data.push({value:poids.POIDS,date:new Date(dateMesureEn)})}),$scope.dataPoids=data},function(err){$scope.error=err}),$("#bs-courbePoids").modal("show")},$scope.listMesures=function(){$scope.success="",$scope.error="",$scope.loading=!0;var allUser={};allUser.email="Tous",allUser.id=0,allUser.role=0,$scope.usermesure=allUser,UtilisateurFactory.list(function(res){$scope.success="Succes";var result=_.filter(res,function(user){return user.role<2});result.unshift(allUser),$scope.users=result},function(err){$scope.error=err}),$("#mesures").fullCalendar({eventClick:function(calEvent){$scope.id=calEvent.id,"POIDS"==calEvent.type?$scope.createPoidsLoad(calEvent.id):$scope.createRepasLoad(calEvent.id)},header:{left:"prev,next today",center:"title",right:"month,basicWeek,agendaWeek,agendaDay"},defaultView:"basicWeek",editable:!0,eventLimit:!0,events:function(start,end,timezone,callback){var dateStart=start._d,dateStartString=dateStart.getFullYear()+"-"+(dateStart.getMonth()+1)+"-"+dateStart.getDate(),dateEnd=end._d,dateEndString=dateEnd.getFullYear()+"-"+(dateEnd.getMonth()+1)+"-"+dateEnd.getDate();MesureFactory.list($scope.usermesure.email,dateStartString,dateEndString,function(res){$scope.success="Succes";var events=[];_.each(res,function(mesure){if("POIDS"==mesure.TYPE){var dateMesureTab=mesure.DATEMESURE.split("-"),dateMesureEn=dateMesureTab[2]+"-"+dateMesureTab[1]+"-"+dateMesureTab[0];events.push({id:mesure.ID,title:mesure.EMAIL+" : "+mesure.POIDS,start:dateMesureEn,backgroundColor:"#00c0ef",borderColor:"#00c0ef",editable:!1,type:"POIDS"})}else if("REPAS"==mesure.TYPE){var eventValue={id:mesure.ID,title:mesure.EMAIL,start:mesure.DATEHEUREMESURE,allDay:!1,editable:!1,type:"REPAS"};""===mesure.COMMENTAIREDIET?(eventValue.backgroundColor="#F39C12",eventValue.borderColor="#E08E0B",events.push(eventValue)):(eventValue.backgroundColor="#5CB85C",eventValue.borderColor="#4CAE4C",events.push(eventValue))}}),callback(events)},function(err){$scope.error=err})}})},$scope.listMesMesures=function(){$scope.success="",$scope.error="",$scope.loading=!0;var allUser={};allUser.email=$scope.user.email,allUser.id=0,allUser.role=0,$scope.usermesure=allUser,$("#mesures").fullCalendar({eventClick:function(calEvent){$scope.id=calEvent.id,"POIDS"==calEvent.type?$scope.createPoidsLoad(calEvent.id):$scope.createRepasLoad(calEvent.id)},header:{left:"prev,next today",center:"title",right:"month,basicWeek,agendaWeek,agendaDay"},defaultView:"basicWeek",editable:!0,eventLimit:!0,events:function(start,end,timezone,callback){var dateStart=start._d,dateStartString=dateStart.getFullYear()+"-"+(dateStart.getMonth()+1)+"-"+dateStart.getDate(),dateEnd=end._d,dateEndString=dateEnd.getFullYear()+"-"+(dateEnd.getMonth()+1)+"-"+dateEnd.getDate();MesureFactory.listMine(dateStartString,dateEndString,function(res){$scope.success="Succes";var events=[];_.each(res,function(mesure){if("POIDS"==mesure.TYPE){var dateMesureTab=mesure.DATEMESURE.split("-"),dateMesureEn=dateMesureTab[2]+"-"+dateMesureTab[1]+"-"+dateMesureTab[0];events.push({id:mesure.ID,title:"Poids : "+mesure.POIDS,start:dateMesureEn,backgroundColor:"#00c0ef",borderColor:"#00c0ef",editable:!1,type:"POIDS"})}else if("REPAS"==mesure.TYPE){var eventValue={id:mesure.ID,title:"Repas : "+mesure.REPAS,start:mesure.DATEHEUREMESURE,allDay:!1,editable:!1,type:"REPAS"};""===mesure.COMMENTAIREDIET?(eventValue.backgroundColor="#F39C12",eventValue.borderColor="#E08E0B",events.push(eventValue)):(eventValue.backgroundColor="#5CB85C",eventValue.borderColor="#4CAE4C",events.push(eventValue))}}),callback(events)},function(err){$scope.error=err})}})},$scope.supprimerPoids=function(id){$scope.success="",$scope.error="";var retVal=confirm("Voulez vous supprimer cette mesure de poids?");retVal===!0&&PoidsFactory.supprimer(id,function(){$scope.success="Succes",$("#mesures").fullCalendar("refetchEvents"),$("#bs-poids").modal("hide")},function(err){$scope.error=err,$("#mesures").fullCalendar("refetchEvents"),$("#bs-poids").modal("hide")})},$scope.supprimerRepas=function(id){$scope.success="",$scope.error="";var retVal=confirm("Voulez vous supprimer ce repas?");retVal===!0&&RepasFactory.supprimer(id,function(){$scope.success="Succes",$("#mesures").fullCalendar("refetchEvents"),$("#bs-repas").modal("hide")},function(err){$scope.error=err,$("#mesures").fullCalendar("refetchEvents"),$("#bs-repas").modal("hide")})},$scope.createPoidsLoad=function(id){if($scope.success="",$scope.error="",$scope.userTous="false",$scope.doublon="false",$scope.abonnementinactif="false",void 0===id)$scope.dateMesure="",$scope.poidsMesure="",$scope.commentaireMesure="",$scope.id="";else{var modeSaisieMesure="";$scope.mesures===!0?modeSaisieMesure="mesures":$scope.mesmesures===!0&&(modeSaisieMesure="mesmesures"),PoidsFactory.get(id,modeSaisieMesure,function(res){$scope.success="Succes",$scope.dateMesure=res.DATEMESURE,$scope.poidsMesure=res.POIDS,$scope.commentaireMesure=res.COMMENTAIRE,$scope.id=id,$scope.emailMesure=res.EMAIL},function(err){$scope.error=err,"Doublon"==err&&($scope.doublon="true")})}$("#dateMesure").datepicker({format:"dd-mm-yyyy",autoclose:!0,weekStart:1}).on("changeDate",function(e){$scope.dateMesure=e.currentTarget.value}),$("#bs-poids").modal("show")},$scope.createRepasLoad=function(id){if($scope.success="",$scope.error="",$scope.userTous="false",$scope.doublon="false",$scope.abonnementinactif="false",void 0===id)$scope.dateRepasMesure="",$scope.heureRepasMesure="",$scope.repasMesure="",$scope.commentaireRepasMesure="",$scope.commentaireRepasDietMesure="",$scope.id="";else{var modeSaisieMesure="";$scope.mesures===!0?modeSaisieMesure="mesures":$scope.mesmesures===!0&&(modeSaisieMesure="mesmesures"),RepasFactory.get(id,modeSaisieMesure,function(res){$scope.success="Succes",$scope.dateRepasMesure=res.DATEMESURE,$scope.heureRepasMesure=res.HEUREMESURE,$scope.repasMesure=res.REPAS,$scope.commentaireRepasMesure=res.COMMENTAIRE,$scope.commentaireRepasDietMesure=res.COMMENTAIREDIET,$scope.id=id,$scope.emailMesure=res.EMAIL},function(err){$scope.error=err,"Doublon"==err&&($scope.doublon="true")})}$("#dateRepasMesure").datepicker({format:"dd-mm-yyyy",autoclose:!0,weekStart:1}).on("changeDate",function(e){$scope.dateRepasMesure=e.currentTarget.value}),$("#heureRepasMesure").timepicker({showMeridian:!1}).on("changeTime.timepicker",function(e){$scope.heureRepasMesure=e.time.value}),$("#bs-repas").modal("show")},$scope.addPoids=function(){$scope.success="",$scope.error="",$scope.doublon="false",$scope.abonnementinactif="false",$scope.userTous="false";var objetValue={};objetValue.dateMesure=$scope.dateMesure,objetValue.poidsMesure=$scope.poidsMesure,objetValue.commentaireMesure=$scope.commentaireMesure;var modeSaisieMesure="";$scope.mesures===!0?modeSaisieMesure="mesures":$scope.mesmesures===!0&&(modeSaisieMesure="mesmesures"),objetValue.email=$scope.usermesure.email,""===$scope.id?"Tous"==objetValue.email?$scope.userTous="true":PoidsFactory.put(objetValue,modeSaisieMesure,function(){$scope.success="Succes",$("#mesures").fullCalendar("refetchEvents"),$("#bs-poids").modal("hide")},function(err){$scope.error=err,"Doublon"==err&&($scope.doublon="true"),"AbonnementInactif"==err&&($scope.abonnementinactif="true")}):(objetValue.id=$scope.id,PoidsFactory.post(objetValue,modeSaisieMesure,function(){$scope.success="Succes",$("#mesures").fullCalendar("refetchEvents"),$("#bs-poids").modal("hide")
},function(err){$scope.error=err,"Doublon"==err&&($scope.doublon="true"),"AbonnementInactif"==err&&($scope.abonnementinactif="true")}))},$scope.addRepas=function(){$scope.success="",$scope.error="",$scope.doublon="false",$scope.abonnementinactif="false",$scope.userTous="false";var objetValue={};objetValue.dateRepasMesure=$scope.dateRepasMesure,objetValue.heureRepasMesure=$scope.heureRepasMesure,objetValue.repasMesure=$scope.repasMesure,objetValue.commentaireRepasMesure=$scope.commentaireRepasMesure,objetValue.commentaireRepasDietMesure=$scope.commentaireRepasDietMesure;var modeSaisieMesure="";$scope.mesures===!0?modeSaisieMesure="mesures":$scope.mesmesures===!0&&(modeSaisieMesure="mesmesures"),objetValue.email=$scope.usermesure.email,""===$scope.id?"Tous"==objetValue.email?$scope.userTous="true":RepasFactory.put(objetValue,modeSaisieMesure,function(){$scope.success="Succes",$("#mesures").fullCalendar("refetchEvents"),$("#bs-repas").modal("hide")},function(err){$scope.error=err,"Doublon"==err&&($scope.doublon="true"),"AbonnementInactif"==err&&($scope.abonnementinactif="true")}):(objetValue.id=$scope.id,RepasFactory.post(objetValue,modeSaisieMesure,function(){$scope.success="Succes",$("#mesures").fullCalendar("refetchEvents"),$("#bs-repas").modal("hide")},function(err){$scope.error=err,"Doublon"==err&&($scope.doublon="true"),"AbonnementInactif"==err&&($scope.abonnementinactif="true")}))},action){case"listMesMesures":$scope.listMesMesures();break;case"listMesures":$scope.listMesures();break;case"addPoids":$scope.mesmesures=!0,$scope.listMesMesures(),$scope.createPoidsLoad();break;case"addRepas":$scope.mesmesures=!0,$scope.listMesMesures(),$scope.createRepasLoad()}}])}(),function(){"use strict";angular.module("EspaceNutrition").factory("PoidsFactory",["$http",function($http){return{list:function(email,success,error){$http.get("/api/listpoids/"+email).success(success).error(error)},get:function(id,modeSaisieMesure,success,error){"mesures"===modeSaisieMesure?$http.get("/api/poids/"+id).success(success).error(error):"mesmesures"===modeSaisieMesure&&$http.get("/api/monpoids/"+id).success(success).error(error)},supprimer:function(id,success,error){$http({method:"DELETE",url:"/api/poids/"+id}).success(success).error(error)},put:function(objet,modeSaisieMesure,success,error){"mesures"===modeSaisieMesure?$http.put("/api/poids",objet).success(success).error(error):"mesmesures"===modeSaisieMesure&&$http.put("/api/monpoids",objet).success(success).error(error)},post:function(objet,modeSaisieMesure,success,error){"mesures"===modeSaisieMesure?$http.post("/api/poids",objet).success(success).error(error):"mesmesures"===modeSaisieMesure&&$http.post("/api/monpoids",objet).success(success).error(error)}}}]),angular.module("EspaceNutrition").factory("RepasFactory",["$http",function($http){return{get:function(id,modeSaisieMesure,success,error){"mesures"===modeSaisieMesure?$http.get("/api/repas/"+id).success(success).error(error):"mesmesures"===modeSaisieMesure&&$http.get("/api/monrepas/"+id).success(success).error(error)},supprimer:function(id,success,error){$http({method:"DELETE",url:"/api/repas/"+id}).success(success).error(error)},put:function(objet,modeSaisieMesure,success,error){"mesures"===modeSaisieMesure?$http.put("/api/repas",objet).success(success).error(error):"mesmesures"===modeSaisieMesure&&$http.put("/api/monrepas",objet).success(success).error(error)},post:function(objet,modeSaisieMesure,success,error){"mesures"===modeSaisieMesure?$http.post("/api/repas",objet).success(success).error(error):"mesmesures"===modeSaisieMesure&&$http.post("/api/monrepas",objet).success(success).error(error)}}}]),angular.module("EspaceNutrition").factory("MesureFactory",["$http",function($http){return{list:function(email,dateStart,dateEnd,success,error){$http.get("/api/mesures/"+email+"/"+dateStart+"/"+dateEnd).success(success).error(error)},listMine:function(dateStart,dateEnd,success,error){$http.get("/api/mesmesures/"+dateStart+"/"+dateEnd).success(success).error(error)},getLastMesure:function(success,error){$http.get("/api/lastmesures").success(success).error(error)}}}])}(),function(){"use strict";angular.module("EspaceNutrition").controller("PaiementCtrl",["$rootScope","$scope","$location","$route","$window","Auth","PaiementFactory",function($rootScope,$scope,$location,$route,$window,Auth,PaiementFactory){$scope.user=Auth.user,$scope.userRoles=Auth.userRoles,$scope.accessLevels=Auth.accessLevels;var action="";switch(void 0!==$route&&$route.current&&void 0!==$route.current.action&&(action=$route.current.action),$scope.listPaiement=function(){$scope.success="",$scope.error="",$scope.loading=!0,PaiementFactory.list(function(res){$scope.loading=!1;{var data=$.map(res,function(el){return[[el.business,el.txnid,el.payment_amount,el.payment_status,el.item_name,el.payer_id,el.payer_first_name,el.payer_last_name,el.payer_email,el.createdtime,el.mode]]});$("#paiements").dataTable({aaData:data,aoColumns:[{sTitle:"Destinataire"},{sTitle:"Txn ID"},{sTitle:"Montant"},{sTitle:"Statut"},{sTitle:"Item"},{sTitle:"Id payeur"},{sTitle:"Prénom payeur"},{sTitle:"Nom payeur"},{sTitle:"Email payeur"},{sTitle:"Date paiement"},{sTitle:"Mode"}],oLanguage:{sSearch:"Recherche:",sZeroRecords:"Pas d'éléménts à afficher",sInfo:"_START_ sur _END_ de _TOTAL_ éléments",sInfoEmpty:"Pas d'éléments",sInfoFiltered:" - filtrés sur _MAX_ éléments",sLengthMenu:"Afficher _MENU_ éléments",oPaginate:{sFirst:"Premier",sLast:"Dernier",sNext:"Suivant",sPrevious:"Précédent"}},order:[[9,"desc"]]})}},function(){$scope.error="Impossible de recuperer les paiements",$scope.loading=!1})},action){case"listPaiement":$scope.listPaiement()}}])}(),function(){"use strict";angular.module("EspaceNutrition").factory("PaiementFactory",["$http",function($http){return{list:function(success,error){$http.get("/api/paiements").success(success).error(error)}}}])}(),function(){"use strict";angular.module("EspaceNutrition").controller("EspaceNutritionPublicCtrl",["$rootScope","$scope","$location","$route","$window","PublicFactory",function($rootScope,$scope,$location,$route,$window,PublicFactory){var action="";switch(void 0!==$route&&$route.current&&void 0!==$route.current.action&&(action=$route.current.action),$scope.affichePopupPaiement=function(id){$scope.success="",$scope.error="",$scope.idPaiement=id,$("#bs-paiement").modal("show")},$scope.redirectionPaiement=function(){$("#bs-paiement").modal("hide");var paramRedirect="";paramRedirect=paramRedirect+"?business="+routingConfig.paypal.business,paramRedirect=paramRedirect+"&item_name="+routingConfig.item[$scope.idPaiement].libelle,paramRedirect=paramRedirect+"&amount="+routingConfig.item[$scope.idPaiement].amount,paramRedirect+="&cmd=_xclick",paramRedirect+="&no_note=1",paramRedirect+="&lc=FR",paramRedirect+="&currency_code=EUR",paramRedirect+="&bn=EspaceNutrition_BuyNow_WPS_FR",paramRedirect=paramRedirect+"&first_name="+$scope.prenom,paramRedirect=paramRedirect+"&last_name="+$scope.nom,paramRedirect=paramRedirect+"&payer_email="+$scope.email,paramRedirect+="&item_number=1",paramRedirect=paramRedirect+"&return="+routingConfig.paypal.urlReturn,paramRedirect=paramRedirect+"&cancel_return="+routingConfig.paypal.urlCancel,paramRedirect=paramRedirect+"&notify_url="+routingConfig.paypal.urlNotify;var baseURL="https://www.";routingConfig.paypal.sandbox===!0&&(baseURL+="sandbox."),baseURL+="paypal.com/cgi-bin/webscr",$window.location.href=baseURL+encodeURI(paramRedirect)},$scope.paiementSuccess=function(){void 0===$rootScope.affichePopup&&($("#bs-paiementSuccess").modal("show"),$rootScope.affichePopup=!1)},$scope.sendMessage=function(){if($scope.success="",void 0===$scope.champControl){var objetValue={};objetValue.email=$scope.email,objetValue.nom=$scope.nom,objetValue.telephone=$scope.telephone,objetValue.message=$scope.message,PublicFactory.sendMessage(objetValue,function(){$scope.initFieldContact(),$scope.success="Message envoyé avec succès"},function(err){$scope.error=err})}},$scope.initFieldContact=function(){$scope.sliderValue=0,$scope.initValueWait=Math.floor(100*Math.random()+1)},$scope.$watch("sliderValue",function(newValue){$scope.subForm5.$setDirty(),$scope.subForm5.$setValidity("sliderControl",!1),newValue==$scope.initValueWait&&$scope.subForm5.$setValidity("sliderControl",!0)}),action){case"paiementSuccess":$scope.paiementSuccess(),$scope.initFieldContact();break;default:$scope.initFieldContact()}}])}(),function(){"use strict";angular.module("EspaceNutrition").directive("slider",function(){return{link:function(scope,element,attrs){var width,offset,$element=$(element),$bar=$("span",$element),step=attrs.step,mouseDown=!1;element.on("mousedown touchstart",function(){mouseDown=!0,width||(width=$element.width()),offset||(offset=$bar.offset().left)}),element.on("mouseup touchend",function(){mouseDown=!1}),element.on("mousemove touchmove",_.throttle(function(evt){if(mouseDown){var diff;if(diff=evt.pageX?evt.pageX-offset:evt.originalEvent.touches[0].pageX-offset,0>diff)scope.sliderValue=attrs.min,$bar.width("0%");else if(diff>width)scope.sliderValue=attrs.max,$bar.width("100%");else{var percent=diff/width;$bar.width(100*percent+"%"),scope.sliderValue=Math.round(percent*attrs.max/step)*step}scope.$apply()}},25)),scope.$watch("sliderValue",function(sliderValue){$bar.width(sliderValue/attrs.max*100+"%")})}}})}(),function(){"use strict";angular.module("EspaceNutrition").factory("PublicFactory",["$http","$window",function($http){return{sendMessage:function(message,success,error){$http.post("/api/sendMessage",message).success(function(){success()}).error(error)}}}])}(),function(){"use strict";angular.module("EspaceNutrition").controller("UtilisateurCtrl",["$rootScope","$scope","$location","$route","$window","Auth","UtilisateurFactory",function($rootScope,$scope,$location,$route,$window,Auth,UtilisateurFactory){$scope.user=Auth.user,$scope.userRoles=Auth.userRoles,$scope.accessLevels=Auth.accessLevels;var action="";switch(void 0!==$route&&$route.current&&void 0!==$route.current.action&&(action=$route.current.action),$scope.role="1",$scope.supprimer=function(id){$scope.success="",$scope.error="";var retVal=confirm("Voulez vous supprimer cet utilisateur?");retVal===!0&&UtilisateurFactory.supprimer(id,function(){$scope.success="Succes",$route.reload()},function(err){$scope.error=err,$route.reload()})},$scope.updateLoad=function(id){$scope.success="",$scope.error="",UtilisateurFactory.get(id,function(res){$scope.email=res.EMAIL,$scope.nom=res.NOM,$scope.prenom=res.PRENOM,$scope.datenaissance=res.DATENAISSANCE,$scope.role=res.ROLE,$scope.actif=res.ACTIF,$scope.id=res.ID,$scope.success="Succes",$("#dateNaissanceUtilisateur").datepicker({format:"dd-mm-yyyy",autoclose:!0,weekStart:1}).on("changeDate",function(e){$scope.datenaissance=e.currentTarget.value}),$("#bs-ajoututilisateur").modal("show")},function(err){$scope.error=err})},$scope.createLoad=function(){$scope.success="",$scope.error="",$scope.email="",$scope.nom="",$scope.prenom="",$scope.datenaissance="",$scope.role=1,$scope.id="",$("#dateNaissanceUtilisateur").datepicker({format:"dd-mm-yyyy",autoclose:!0,weekStart:1}).on("changeDate",function(e){$scope.datenaissance=e.currentTarget.value}),$("#bs-ajoututilisateur").modal("show")},$scope.add=function(){$scope.success="",$scope.error="",$scope.doublon="false";var objetValue={};objetValue.email=$scope.email,objetValue.nom=$scope.nom,objetValue.prenom=$scope.prenom,objetValue.datenaissance=$scope.datenaissance,objetValue.role=$scope.role,""===$scope.id?UtilisateurFactory.put(objetValue,function(){$scope.success="Succes",$("#bs-ajoututilisateur").on("hidden.bs.modal",function(){$route.reload()}),$("#bs-ajoututilisateur").modal("hide")},function(err){$scope.error=err,"Doublon"==err&&($scope.doublon="true")}):(objetValue.id=$scope.id,objetValue.actif=$scope.actif,UtilisateurFactory.post(objetValue,function(){$scope.success="Succes",$("#bs-ajoututilisateur").on("hidden.bs.modal",function(){$route.reload()}),$("#bs-ajoututilisateur").modal("hide")},function(err){$scope.error=err,"Doublon"==err&&($scope.doublon="true")}))},$scope.listUtilisateur=function(){$scope.success="",$scope.error="",$scope.loading=!0,UtilisateurFactory.list(function(res){$scope.loading=!1;{var data=$.map(res,function(el){return[[el.id,el.email,el.nom,el.prenom,el.role,el.actif,""]]});$("#utilisateurs").dataTable({aaData:data,aoColumns:[{sTitle:"Id"},{sTitle:"Email"},{sTitle:"Nom"},{sTitle:"Prénom"},{sTitle:"Role"},{sTitle:"Actif"},{sTitle:"Action"}],oLanguage:{sSearch:"Recherche:",sZeroRecords:"Pas d'éléménts à afficher",sInfo:"_START_ sur _END_ de _TOTAL_ éléments",sInfoEmpty:"Pas d'éléments",sInfoFiltered:" - filtrés sur _MAX_ éléments",sLengthMenu:"Afficher _MENU_ éléments",oPaginate:{sFirst:"Premier",sLast:"Dernier",sNext:"Suivant",sPrevious:"Précédent"}},aoColumnDefs:[{targets:0,visible:!1,searchable:!1},{targets:4,sType:"html",render:function(data){var spanOuv="&lt;span class=&quot;label ",label="";switch(data){case"0":label="label-danger&quot;&gt;Non autorisé";break;case"1":label="label-info&quot;&gt;Utilisateur";break;default:label="label-success&quot;&gt;Admin"}var spanFerm="&lt;/span&gt;",result=spanOuv.concat(label).concat(spanFerm);return $("<div/>").html(result).text()}},{targets:5,sType:"html",render:function(data){var spanOuv="&lt;span class=&quot;label ",label="";switch(data){case"0":label="label-info&quot;&gt;Non actif";break;case"1":label="label-success&quot;&gt;Actif";break;default:label="label-danger&quot;&gt;???"}var spanFerm="&lt;/span&gt;",result=spanOuv.concat(label).concat(spanFerm);return $("<div/>").html(result).text()}},{aTargets:[6],sType:"html",render:function(data,type,row){var result="",resultTmp="",id="",fin="";return resultTmp="&lt;button class=&quot;btn btn-link&quot; ng-click=&quot;update(",id=row[0],fin=")&quot; type=&quot;button&quot;&gt;&lt;span class=&quot;fa fa-pencil&quot;&gt;&lt;/span&gt;&lt;/button&gt;",result=resultTmp.concat(id).concat(fin),$scope.user.email!=row[1]&&(resultTmp="&lt;button class=&quot;btn btn-link app-btn-delete&quot; ng-click=&quot;delete(",id=row[0],fin=")&quot; type=&quot;button&quot;&gt;&lt;span class=&quot;fa fa-times&quot;&gt;&lt;/span&gt;&lt;/button&gt;",result=result.concat(resultTmp).concat(id).concat(fin)),$("<div/>").html(result).text()}}]})}$("#utilisateurs tbody").on("click","button",function(){var name=this.attributes[1].nodeName,value=this.attributes[1].nodeValue,tab="",result="";"ng-click"==name&&-1!=value.indexOf("delete")&&(tab=value.split("("),result=tab[1],tab=result.split(")"),result=tab[0],$scope.supprimer(result)),"ng-click"==name&&-1!=value.indexOf("update")&&(tab=value.split("("),result=tab[1],tab=result.split(")"),result=tab[0],$scope.updateLoad(result))})},function(){$scope.error="Impossible de recuperer les utilisateurs",$scope.loading=!1})},action){case"listUtilisateur":$scope.listUtilisateur()}}])}(),function(){"use strict";angular.module("EspaceNutrition").factory("UtilisateurFactory",["$http",function($http){var userRoles=routingConfig.userRoles;return{list:function(success,error){$http.get("/api/utilisateurs").success(success).error(error)},add:function(objet,success,error){$http.post("/api/utilisateur",objet).success(success).error(error)},get:function(id,success,error){$http.get("/api/utilisateur/"+id).success(success).error(error)},supprimer:function(id,success,error){$http({method:"DELETE",url:"/api/utilisateur/"+id}).success(success).error(error)},put:function(objet,success,error){$http.put("/api/utilisateur",objet).success(success).error(error)},post:function(objet,success,error){$http.post("/api/utilisateur",objet).success(success).error(error)},userRoles:userRoles}}])}();